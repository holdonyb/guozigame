<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‹¼è¯»é­”æ³•å¸ˆ (Phonics Wizard)</title>
  <style>
    /* å…¨å±€æ ·å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #7579ff 0%, #b224ef 100%);
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    /* æ ‡é¢˜å’ŒçŠ¶æ€æ  */
    header {
      width: 100%;
      padding: 1rem;
      text-align: center;
      background-color: rgba(0, 0, 0, 0.2);
      position: relative;
    }
    
    h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    #stats-bar {
      display: flex;
      justify-content: space-around;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      font-size: 1rem;
    }
    
    .stat {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    /* æ¸¸æˆå®¹å™¨ */
    main {
      width: 100%;
      max-width: 800px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      position: relative;
    }
    
    /* æ¸¸æˆå±å¹• */
    .screen {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity 0.5s;
      opacity: 0;
      pointer-events: none;
      padding: 2rem;
    }
    
    .screen.active {
      opacity: 1;
      pointer-events: all;
    }
    
    /* å¼€å§‹å±å¹• */
    #start-screen {
      background: rgba(0, 0, 0, 0.7);
      text-align: center;
      z-index: 100;
    }
    
    .title-big {
      font-size: 3rem;
      margin-bottom: 2rem;
      text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff;
      animation: pulse 2s infinite;
    }
    
    .btn {
      background: linear-gradient(45deg, #ff416c, #ff4b2b);
      border: none;
      color: white;
      padding: 1rem 2rem;
      margin: 0.5rem;
      border-radius: 50px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
    }
    
    .btn:active {
      transform: translateY(1px);
    }
    
    /* é­”æ³•é˜µ */
    #magic-circle-container {
      position: relative;
      width: 280px;
      height: 280px;
      margin: 2rem 0;
    }
    
    #magic-circle {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 4px dashed #ffd700;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.1);
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
      transition: all 0.3s;
    }
    
    #magic-circle::before {
      content: '';
      position: absolute;
      width: 90%;
      height: 90%;
      border-radius: 50%;
      border: 2px dotted #ffd700;
      animation: rotate 20s linear infinite;
    }
    
    #magic-circle::after {
      content: '';
      position: absolute;
      width: 70%;
      height: 70%;
      border-radius: 50%;
      border: 1px solid #ffd700;
      animation: rotate 15s linear infinite reverse;
    }
    
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    #magic-circle.glow {
      box-shadow: 0 0 30px #ffd700, 0 0 50px #ffd700;
      background: rgba(255, 215, 0, 0.2);
    }
    
    #magic-circle-content {
      font-size: 5rem;
      z-index: 2;
      text-shadow: 0 0 10px white;
    }
    
    /* æ¶ˆæ¯åŒºåŸŸ */
    #message-container {
      min-height: 80px;
      width: 100%;
      text-align: center;
      margin: 1rem 0;
      position: relative;
    }
    
    #message {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 1rem;
      font-size: 1.2rem;
      max-width: 90%;
      margin: 0 auto;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.3s;
    }
    
    /* å­—æ¯å¡ç‰‡åŒº */
    #letter-bank {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      margin: 1rem 0;
      min-height: 100px;
    }
    
    .card {
      width: 70px;
      height: 90px;
      background: linear-gradient(135deg, #3498db, #2980b9);
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2.5rem;
      color: white;
      cursor: pointer;
      user-select: none;
      transition: all 0.2s;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: 0.5s;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }
    
    .card:hover::before {
      left: 100%;
    }
    
    .card.dragging {
      opacity: 0.7;
    }
    
    /* æ‹¼è¯»ç›®æ ‡åŒºåŸŸ */
    #phonics-target {
      font-size: 3rem;
      background: rgba(0, 0, 0, 0.2);
      padding: 1rem 2rem;
      border-radius: 50px;
      margin: 1rem 0;
      min-width: 200px;
      text-align: center;
      letter-spacing: 5px;
    }
    
    #phonics-target.highlight {
      background: rgba(255, 215, 0, 0.3);
      box-shadow: 0 0 15px gold;
    }
    
    /* å£°éŸ³å¯¹å†³åŒºåŸŸ */
    #duel-container {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }
    
    #word-options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
    }
    
    .word-card {
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white;
      padding: 0.8rem 1.5rem;
      border-radius: 10px;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .word-card:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }
    
    /* å‡çº§æ•ˆæœ */
    #level-up {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s;
    }
    
    #level-up.show {
      opacity: 1;
      pointer-events: all;
    }
    
    #level-up-content {
      text-align: center;
      animation: scaleUp 0.5s forwards;
    }
    
    /* ç¤ºä¾‹è¯åŒºåŸŸ */
    #example-words {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      margin: 1rem 0;
    }
    
    .example-word {
      background: rgba(255, 255, 255, 0.2);
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .example-word:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.05);
    }
    
    /* å›¾åƒæ˜¾ç¤ºåŒº */
    #image-display {
      width: 150px;
      height: 150px;
      margin: 1rem auto;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 4rem;
      overflow: hidden;
      position: relative;
    }
    
    .image-icon {
      font-size: 4rem;
      transition: all 0.5s;
    }
    
    .image-icon.animate {
      animation: bounce 0.5s ease-in-out;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    
    @keyframes scaleUp {
      0% { transform: scale(0.5); }
      80% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    /* åŠ¨ç”»æ•ˆæœ */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes pulse {
      0% { text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff; }
      50% { text-shadow: 0 0 15px #ff00ff, 0 0 30px #ff00ff, 0 0 40px #ff00ff; }
      100% { text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff; }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    
    .shake {
      animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 600px) {
      h1 { font-size: 1.5rem; }
      #stats-bar { font-size: 0.8rem; }
      .title-big { font-size: 2rem; }
      .btn { padding: 0.8rem 1.5rem; font-size: 1rem; }
      #magic-circle-container { width: 220px; height: 220px; }
      .card { width: 60px; height: 80px; font-size: 2rem; }
      #phonics-target { font-size: 2.5rem; }
      .word-card { font-size: 1.2rem; padding: 0.6rem 1.2rem; }
    }
    
    /* æ·¡å…¥æ•ˆæœ */
    .fade-in {
      animation: fadeIn 0.5s forwards;
    }
    
    /* éšè—å…ƒç´  */
    .hidden {
      display: none;
    }

    /* ç®€å•CSSå›¾åƒ */
    .css-apple {
      width: 60px;
      height: 60px;
      background-color: #ff3b30;
      border-radius: 50%;
      position: relative;
      margin: 20px auto;
    }
    
    .css-apple::before {
      content: '';
      position: absolute;
      top: -15px;
      left: 25px;
      width: 10px;
      height: 20px;
      background-color: #8e8e93;
      border-radius: 5px 5px 0 0;
    }
    
    .css-apple::after {
      content: '';
      position: absolute;
      top: 15px;
      right: 15px;
      width: 10px;
      height: 10px;
      background-color: white;
      border-radius: 50%;
    }
    
    .css-cat {
      position: relative;
      width: 80px;
      height: 60px;
      background-color: #a0522d;
      border-radius: 30px;
      margin: 30px auto 10px;
    }
    
    .css-cat::before {
      content: '';
      position: absolute;
      top: -20px;
      left: 15px;
      width: 50px;
      height: 40px;
      background-color: #a0522d;
      border-radius: 50%;
    }
    
    .css-cat::after {
      content: '';
      position: absolute;
      top: -15px;
      left: 25px;
      width: 10px;
      height: 10px;
      background-color: black;
      border-radius: 50%;
      box-shadow: 20px 0 0 0 black;
    }
    
    .css-cat-ear {
      position: absolute;
      top: -30px;
      left: 15px;
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-bottom: 25px solid #a0522d;
    }
    
    .css-cat-ear:last-child {
      left: 50px;
    }
    
    .css-dog {
      position: relative;
      width: 80px;
      height: 60px;
      background-color: #cd853f;
      border-radius: 30px;
      margin: 30px auto 10px;
    }
    
    .css-dog::before {
      content: '';
      position: absolute;
      top: -20px;
      left: 15px;
      width: 50px;
      height: 40px;
      background-color: #cd853f;
      border-radius: 50%;
    }
    
    .css-dog::after {
      content: '';
      position: absolute;
      top: -15px;
      left: 25px;
      width: 10px;
      height: 10px;
      background-color: black;
      border-radius: 50%;
      box-shadow: 20px 0 0 0 black;
    }
    
    .css-dog-ear {
      position: absolute;
      top: -35px;
      left: 10px;
      width: 20px;
      height: 30px;
      background-color: #cd853f;
      border-radius: 50% 50% 0 0;
    }
    
    .css-dog-ear:last-child {
      left: 50px;
    }
    
    .css-ball {
      width: 60px;
      height: 60px;
      background: radial-gradient(circle at 20px 20px, #ff9500, #ff3b30);
      border-radius: 50%;
      margin: 20px auto;
    }
    
    .css-hat {
      position: relative;
      width: 80px;
      height: 10px;
      background-color: #8e8e93;
      border-radius: 5px;
      margin: 30px auto 10px;
    }
    
    .css-hat::after {
      content: '';
      position: absolute;
      top: -30px;
      left: 20px;
      width: 40px;
      height: 30px;
      background-color: #8e8e93;
      border-radius: 50% 50% 0 0;
    }
    
    /* æŒ‡å¯¼æ•™å­¦ */
    .guide-container {
      background: rgba(0, 0, 0, 0.5);
      padding: 1rem;
      border-radius: 10px;
      margin: 1rem 0;
      text-align: center;
    }
    
    .guide-title {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      color: #ffd700;
    }
    
    .progress-bar {
      width: 100%;
      height: 10px;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 5px;
      margin: 0.5rem 0;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background-color: #4cd964;
      border-radius: 5px;
      transition: width 0.5s;
    }
    
    /* ä»»åŠ¡æç¤º */
    .task-hint {
      background-color: rgba(255, 215, 0, 0.2);
      border: 2px dashed #ffd700;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      margin: 1rem 0;
      text-align: center;
      animation: pulse-border 2s infinite;
    }
    
    @keyframes pulse-border {
      0%, 100% { border-color: #ffd700; }
      50% { border-color: #ff9500; }
    }
  </style>
</head>
<body>
  <header>
    <h1>æ‹¼è¯»é­”æ³•å¸ˆ (Phonics Wizard)</h1>
    <div id="stats-bar">
      <div class="stat">
        <span>é­”æ³•ç­‰çº§:</span>
        <span id="level">1</span>
      </div>
      <div class="stat">
        <span>ç»éªŒå€¼:</span>
        <span id="xp">0</span>/<span id="next-level">5</span>
      </div>
      <div class="stat">
        <span>è¿å‡»:</span>
        <span id="combo">0</span>
      </div>
    </div>
  </header>

  <main>
    <!-- å¼€å§‹å±å¹• -->
    <div id="start-screen" class="screen active">
      <h2 class="title-big">æ‹¼è¯»é­”æ³•å¸ˆ</h2>
      <p>æ¬¢è¿æ¥åˆ°é­”æ³•å­¦é™¢ï¼é€šè¿‡æ‹¼è¯»é­”æ³•å’’è¯­ï¼Œé‡Šæ”¾å¼ºå¤§çš„é­”æ³•åŠ›é‡ï¼</p>
      <div class="guide-container">
        <div class="guide-title">æ¸¸æˆç©æ³•</div>
        <p>1. å…ˆå­¦ä¹ å­—æ¯å‘éŸ³ï¼Œç‚¹å‡»å­—æ¯æŸ¥çœ‹ç¤ºä¾‹å•è¯</p>
        <p>2. æŠŠå­—æ¯æ‹–åˆ°ç©ºæ ¼ä½ç½®ç»„æˆå•è¯</p>
        <p>3. å¬å£°éŸ³æ‰¾æ­£ç¡®å•è¯ï¼Œæˆä¸ºæ‹¼è¯»å¤§å¸ˆï¼</p>
      </div>
      <button id="start-btn" class="btn">å¼€å§‹é­”æ³•è®­ç»ƒ</button>
    </div>

    <!-- å­—æ¯è®¤çŸ¥é˜¶æ®µ -->
    <div id="letter-screen" class="screen">
      <div class="task-hint">
        ä»»åŠ¡ï¼šç‚¹å‡»å­—æ¯ï¼Œå­¦ä¹ å‘éŸ³å¹¶æŸ¥çœ‹ç¤ºä¾‹å•è¯
      </div>
      
      <div id="magic-circle-container">
        <div id="magic-circle">
          <div id="magic-circle-content"></div>
        </div>
      </div>
      
      <div id="message-container">
        <div id="message">ç‚¹å‡»å­—æ¯ï¼Œé‡Šæ”¾é­”æ³•åŠ›é‡ï¼</div>
      </div>
      
      <div id="letter-bank"></div>
      
      <div id="example-words" class="hidden"></div>
      
      <div id="image-display" class="hidden"></div>
    </div>

    <!-- æ‹¼è¯»å…¥é—¨é˜¶æ®µ -->
    <div id="phonics-screen" class="screen">
      <div class="task-hint">
        ä»»åŠ¡ï¼šå°†å·¦è¾¹å­—æ¯æ‹–åˆ°ç©ºæ ¼å¤„ï¼Œå®Œæˆå•è¯æ‹¼å†™
      </div>
      
      <div id="image-display"></div>
      
      <div id="phonics-target" class="hidden"></div>
      
      <div id="message-container">
        <div id="message">å°†å­—æ¯æ‹–åˆ°ç©ºæ ¼ä½ç½®å®Œæˆæ‹¼å†™ï¼</div>
      </div>
      
      <div id="letter-bank"></div>
    </div>

    <!-- å£°éŸ³é­”æ³•å¯¹å†³é˜¶æ®µ -->
    <div id="duel-screen" class="screen">
      <div class="task-hint">
        ä»»åŠ¡ï¼šå¬å•è¯å‘éŸ³ï¼Œé€‰æ‹©æ­£ç¡®çš„å•è¯
      </div>
      
      <div id="magic-circle-container">
        <div id="magic-circle">
          <div id="magic-circle-content"></div>
        </div>
      </div>
      
      <div id="message-container">
        <div id="message">å¬å¥½å•è¯å‘éŸ³ï¼Œå¿«é€Ÿé€‰æ‹©æ­£ç¡®çš„å•è¯ï¼</div>
      </div>
      
      <div id="duel-container">
        <button id="play-sound-btn" class="btn">æ’­æ”¾å‘éŸ³</button>
        <div id="word-options"></div>
      </div>
    </div>
  </main>

  <!-- å‡çº§æç¤º -->
  <div id="level-up">
    <div id="level-up-content">
      <h2>æ­å–œå‡çº§ï¼</h2>
      <p id="level-up-message">ä½ å·²ç»æˆä¸º <span id="new-level">2</span> çº§é­”æ³•å¸ˆ</p>
      <button id="level-up-continue" class="btn">ç»§ç»­å†’é™©</button>
    </div>
  </div>

  <script>
    /* æ¸¸æˆæ•°æ® */
    // å­—æ¯æ•°æ®ä¸ç¤ºä¾‹å•è¯
    const LETTERS_DATA = [
      { letter: 'A', words: ['apple', 'ant', 'astronaut'], icon: 'ğŸ' },
      { letter: 'B', words: ['ball', 'bat', 'book'], icon: 'âš¾' },
      { letter: 'C', words: ['cat', 'car', 'cup'], icon: 'ğŸ±' },
      { letter: 'D', words: ['dog', 'duck', 'door'], icon: 'ğŸ¶' },
      { letter: 'E', words: ['egg', 'elephant', 'exit'], icon: 'ğŸ¥š' },
      { letter: 'F', words: ['fish', 'frog', 'fan'], icon: 'ğŸ ' },
      { letter: 'G', words: ['goat', 'game', 'grass'], icon: 'ğŸ' },
      { letter: 'H', words: ['hat', 'house', 'hand'], icon: 'ğŸ©' },
      { letter: 'I', words: ['igloo', 'insect', 'ice'], icon: 'ğŸ§Š' },
      { letter: 'J', words: ['jump', 'juice', 'jar'], icon: 'ğŸ§ƒ' },
      { letter: 'K', words: ['kite', 'king', 'key'], icon: 'ğŸª' },
      { letter: 'L', words: ['lion', 'lamp', 'leg'], icon: 'ğŸ¦' },
      { letter: 'M', words: ['monkey', 'moon', 'milk'], icon: 'ğŸ’' },
      { letter: 'N', words: ['nest', 'nose', 'net'], icon: 'ğŸª¹' },
      { letter: 'O', words: ['orange', 'octopus', 'ox'], icon: 'ğŸŠ' },
      { letter: 'P', words: ['pig', 'penguin', 'pen'], icon: 'ğŸ·' },
      { letter: 'Q', words: ['queen', 'quilt', 'question'], icon: 'ğŸ‘‘' },
      { letter: 'R', words: ['rabbit', 'robot', 'rocket'], icon: 'ğŸ°' },
      { letter: 'S', words: ['sun', 'star', 'sock'], icon: 'â˜€ï¸' },
      { letter: 'T', words: ['tree', 'turtle', 'table'], icon: 'ğŸŒ³' },
      { letter: 'U', words: ['umbrella', 'unicorn', 'up'], icon: 'â˜‚ï¸' },
      { letter: 'V', words: ['van', 'violin', 'volcano'], icon: 'ğŸš' },
      { letter: 'W', words: ['water', 'whale', 'window'], icon: 'ğŸ’§' },
      { letter: 'X', words: ['x-ray', 'xylophone', 'box'], icon: 'ğŸ“¦' },
      { letter: 'Y', words: ['yo-yo', 'yacht', 'yellow'], icon: 'ğŸŸ¡' },
      { letter: 'Z', words: ['zebra', 'zoo', 'zigzag'], icon: 'ğŸ¦“' }
    ];

    // æ‹¼è¯»ç»„åˆæ•°æ®
    const PHONICS = [
      { suffix: 'at', prefixes: ['c', 'b', 'm', 'h', 'r', 'f'], 
        words: {
          'cat': { icon: 'ğŸ±', cssClass: 'css-cat', description: 'ä¸€åªå¯çˆ±çš„çŒ«' },
          'bat': { icon: 'ğŸ¦‡', cssClass: '', description: 'ä¸€åªè™è ' },
          'hat': { icon: 'ğŸ©', cssClass: 'css-hat', description: 'ä¸€é¡¶å¸½å­' },
          'rat': { icon: 'ğŸ€', cssClass: '', description: 'ä¸€åªè€é¼ ' },
          'mat': { icon: 'ğŸ§©', cssClass: '', description: 'ä¸€å—å«å­' },
          'fat': { icon: 'ğŸ”', cssClass: '', description: 'èƒ–èƒ–çš„' }
        }
      },
      { suffix: 'an', prefixes: ['c', 'm', 'p', 'f', 'r', 'v'], 
        words: {
          'can': { icon: 'ğŸ¥«', cssClass: '', description: 'ä¸€ä¸ªç½å¤´' },
          'man': { icon: 'ğŸ‘¨', cssClass: '', description: 'ä¸€ä¸ªç”·äºº' },
          'pan': { icon: 'ğŸ³', cssClass: '', description: 'ä¸€ä¸ªå¹³åº•é”…' },
          'fan': { icon: 'ğŸŒ¬ï¸', cssClass: '', description: 'ä¸€ä¸ªé£æ‰‡' },
          'ran': { icon: 'ğŸƒ', cssClass: '', description: 'è·‘æ­¥' },
          'van': { icon: 'ğŸš', cssClass: '', description: 'ä¸€è¾†é¢åŒ…è½¦' }
        }
      },
      { suffix: 'in', prefixes: ['p', 'f', 't', 'w', 'b', 's'], 
        words: {
          'pin': { icon: 'ğŸ“Œ', cssClass: '', description: 'ä¸€ä¸ªåˆ«é’ˆ' },
          'fin': { icon: 'ğŸ¬', cssClass: '', description: 'é±¼é³' },
          'tin': { icon: 'ğŸ¥«', cssClass: '', description: 'ä¸€ä¸ªé”¡ç½' },
          'win': { icon: 'ğŸ†', cssClass: '', description: 'èµ¢' },
          'bin': { icon: 'ğŸ—‘ï¸', cssClass: '', description: 'ä¸€ä¸ªåƒåœ¾æ¡¶' },
          'sin': { icon: 'ğŸ˜ˆ', cssClass: '', description: 'ç½ªè¿‡' }
        }
      },
      { suffix: 'og', prefixes: ['d', 'f', 'l', 'h', 'j', 'b'], 
        words: {
          'dog': { icon: 'ğŸ¶', cssClass: 'css-dog', description: 'ä¸€åªç‹—' },
          'fog': { icon: 'ğŸŒ«ï¸', cssClass: '', description: 'é›¾' },
          'log': { icon: 'ğŸªµ', cssClass: '', description: 'åŸæœ¨' },
          'hog': { icon: 'ğŸ·', cssClass: '', description: 'ä¸€å¤´çŒª' },
          'jog': { icon: 'ğŸƒ', cssClass: '', description: 'æ…¢è·‘' },
          'bog': { icon: 'ğŸ’§', cssClass: '', description: 'æ²¼æ³½' }
        }
      },
      { suffix: 'op', prefixes: ['t', 'h', 'p', 'm', 's', 'c'], 
        words: {
          'top': { icon: 'ğŸ”', cssClass: '', description: 'é¡¶éƒ¨' },
          'hop': { icon: 'ğŸ‡', cssClass: '', description: 'è·³è·ƒ' },
          'pop': { icon: 'ğŸ’¥', cssClass: '', description: 'çˆ†è£‚å£°' },
          'mop': { icon: 'ğŸ§¹', cssClass: '', description: 'æ‹–æŠŠ' },
          'sop': { icon: 'ğŸ§½', cssClass: '', description: 'æµ¸æ³¡' },
          'cop': { icon: 'ğŸ‘®', cssClass: '', description: 'è­¦å¯Ÿ' }
        }
      }
    ];

    // å•è¯åˆ—è¡¨ï¼ˆç”¨äºå£°éŸ³å¯¹å†³é˜¶æ®µï¼‰
    const WORD_LISTS = [
      // ç¬¬ä¸€çº§ - ç®€å•ä¸‰å­—æ¯å•è¯
      ['cat', 'dog', 'pig', 'hat', 'sun', 'pen', 'cup'],
      // ç¬¬äºŒçº§ - æ›´å¤šä¸‰å­—æ¯å•è¯
      ['bat', 'net', 'fog', 'pin', 'map', 'rug', 'box', 'leg'],
      // ç¬¬ä¸‰çº§ - å››å­—æ¯å•è¯
      ['frog', 'ship', 'duck', 'book', 'flag', 'desk', 'hand'],
      // ç¬¬å››çº§ - æ··åˆ
      ['milk', 'lamp', 'nest', 'fish', 'king', 'ring', 'star']
    ];

    // è¶£å‘³äº‹ä»¶æç¤º
    const RANDOM_EVENTS = [
      'ä¸€åªä¼šè·³èˆçš„è‹¹æœå‡ºç°äº†ï¼',
      'ä½ å¬å”¤äº†ä¸€åªå½©è‰²çš„å°é¸Ÿï¼Œå®ƒåœ¨ç©ºä¸­é£ç¿”ï¼',
      'é­”æ³•é˜µä¸­å†’å‡ºäº†è“è‰²çš„æ³¡æ³¡ï¼',
      'ä¸€é¡¶ä¼šè·³è·ƒçš„å¸½å­è¹¦äº†å‡ºæ¥ï¼',
      'ä¸€æ¡å½©è™¹ä»é­”æ³•é˜µä¸­é£å‡ºï¼',
      'é­”æ³•ä¹¦è‡ªåŠ¨ç¿»å¼€ï¼Œé—ªçƒç€é‡‘è‰²çš„å…‰èŠ’ï¼',
      'ä¸€åªå¯çˆ±çš„å°å…”å­ä»é­”æ³•é˜µä¸­è¹¦å‡ºæ¥ï¼',
      'ä½ çš„é­”æ³•æ£’å‘å‡ºäº†é—ªäº®çš„æ˜Ÿæ˜Ÿï¼',
      'ä¸€æœµå°äº‘æœµåœ¨é­”æ³•é˜µä¸Šæ–¹å½¢æˆï¼Œä¸‹èµ·äº†ç³–æœé›¨ï¼',
      'ä¸€ä¸ªç¥ç§˜çš„å®ç®±å‡ºç°äº†ï¼Œé‡Œé¢è—ç€å®è´ï¼',
      'ä½ å˜å‡ºäº†ä¸€ä¸ªä¼šæ—‹è½¬çš„å†°æ·‡æ·‹ï¼',
      'é­”æ³•é˜µå¼€å§‹æ’­æ”¾ç¾å¦™çš„éŸ³ä¹ï¼',
      'ä½ çš„é­”æ³•è®©èŠ±æœµåœ¨å‘¨å›´ç»½æ”¾ï¼',
      'ä¸€åªå°æé¾™ä»é­”æ³•é˜µä¸­æ¢å‡ºå¤´æ¥ï¼',
      'ä½ çš„é­”æ³•è®©å››å‘¨å‡ºç°äº†é—ªé—ªå‘å…‰çš„æ˜Ÿæ˜Ÿï¼'
    ];

    // å‡çº§æç¤º
    const LEVEL_MESSAGES = [
      'ä½ ç°åœ¨æ˜¯è§ä¹ é­”æ³•å­¦å¾’äº†ï¼',
      'æ­å–œæ™‹å‡ä¸ºåˆçº§é­”æ³•å¸ˆï¼ä½ å¯ä»¥å¼€å§‹ç»„åˆå­—æ¯äº†ã€‚',
      'ä½ å·²æˆä¸ºä¸­çº§é­”æ³•å¸ˆï¼å°è¯•å¬éŸ³è¾¨è¯çš„æŒ‘æˆ˜å§ï¼',
      'é«˜çº§é­”æ³•å¸ˆï¼ä½ çš„é­”æ³•æ›´å¼ºå¤§äº†ï¼',
      'é­”å¯¼å£«ï¼ä½ æŒæ¡äº†å¼ºå¤§çš„æ‹¼è¯»é­”æ³•ï¼',
      'å¤§é­”å¯¼å¸ˆï¼ä½ çš„é­”æ³•å·²ç»ç‚‰ç«çº¯é’ï¼',
      'ä¼ å¥‡é­”æ³•å¸ˆï¼æ•´ä¸ªé­”æ³•ä¸–ç•Œéƒ½å¬è¯´è¿‡ä½ çš„åå­—ï¼',
      'ç»ˆæé­”æ³•å¤§å¸ˆï¼ä½ å·²æŒæ¡äº†å‡ ä¹æ‰€æœ‰çš„æ‹¼è¯»å’’è¯­ï¼'
    ];

    // æ¸¸æˆçŠ¶æ€
    let gameState = {
      level: 1,
      xp: 0,
      nextLevelXp: 5,
      levelStep: 5,
      combo: 0,
      maxCombo: 0,
      currentScreen: 'start',
      mastered_letters: [],
      mastered_phonics: [],
      currentPhonics: null,
      currentDuelWords: [],
      targetWord: '',
      soundPlayed: false,
      targetImage: null,
      currentLetterData: null
    };

    /* è¾…åŠ©å‡½æ•° */
    function $(id) { return document.getElementById(id); }
    function rand(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
    
    // è¯­éŸ³åˆæˆå‡½æ•°
    function speak(text) {
      // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯­éŸ³åˆæˆ
      if (!window.speechSynthesis) {
        console.log('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ');
        return;
      }
      
      // åœæ­¢å½“å‰çš„è¯­éŸ³
      window.speechSynthesis.cancel();
      
      const utterance = new SpeechSynthesisUtterance(text);
      // è®¾ç½®è‹±è¯­å‘éŸ³
      utterance.lang = 'en-US';
      // è°ƒæ•´é€Ÿåº¦å’ŒéŸ³è°ƒä½¿å…¶æ›´é€‚åˆå„¿ç«¥
      utterance.rate = 0.8;
      utterance.pitch = 1.2;
      
      // å°è¯•æ’­æ”¾è¯­éŸ³
      try {
        window.speechSynthesis.speak(utterance);
      } catch (e) {
        console.log('è¯­éŸ³åˆæˆå‡ºé”™:', e);
      }
    }

    // ä¿®å¤çš„éŸ³æ•ˆå‡½æ•°
    function playSound(type) {
      try {
        if (type === 'correct') {
          playCorrectSound();
        } else if (type === 'wrong') {
          playWrongSound();
        } else if (type === 'magic') {
          playMagicSound();
        }
      } catch (e) {
        console.log('éŸ³æ•ˆæ’­æ”¾å‡ºé”™:', e);
      }
    }

    function playCorrectSound() {
      try {
        const context = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = context.createOscillator();
        const gainNode = context.createGain();
        
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(600, context.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(800, context.currentTime + 0.1);
        
        gainNode.gain.setValueAtTime(0.5, context.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.001, context.currentTime + 0.5);
        
        oscillator.connect(gainNode);
        gainNode.connect(context.destination);
        
        oscillator.start();
        oscillator.stop(context.currentTime + 0.5);
      } catch (e) {
        console.log('æ­£ç¡®éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
      }
    }

    function playWrongSound() {
      try {
        const context = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = context.createOscillator();
        const gainNode = context.createGain();
        
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(300, context.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(150, context.currentTime + 0.2);
        
        gainNode.gain.setValueAtTime(0.5, context.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.001, context.currentTime + 0.5);
        
        oscillator.connect(gainNode);
        gainNode.connect(context.destination);
        
        oscillator.start();
        oscillator.stop(context.currentTime + 0.5);
      } catch (e) {
        console.log('é”™è¯¯éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
      }
    }

    function playMagicSound() {
      try {
        const context = new (window.AudioContext || window.webkitAudioContext)();
        
        // åˆ›å»ºå¤šä¸ªéŸ³ç¬¦
        for (let i = 0; i < 5; i++) {
          const oscillator = context.createOscillator();
          const gainNode = context.createGain();
          
          oscillator.type = 'sine';
          const baseFreq = 300 + i * 100;
          oscillator.frequency.setValueAtTime(baseFreq, context.currentTime + i * 0.05);
          oscillator.frequency.exponentialRampToValueAtTime(baseFreq + 100, context.currentTime + i * 0.05 + 0.2);
          
          gainNode.gain.setValueAtTime(0, context.currentTime + i * 0.05);
          gainNode.gain.exponentialRampToValueAtTime(0.2, context.currentTime + i * 0.05 + 0.05);
          gainNode.gain.exponentialRampToValueAtTime(0.001, context.currentTime + i * 0.05 + 0.5);
          
          oscillator.connect(gainNode);
          gainNode.connect(context.destination);
          
          oscillator.start(context.currentTime + i * 0.05);
          oscillator.stop(context.currentTime + i * 0.05 + 0.5);
        }
      } catch (e) {
        console.log('é­”æ³•éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
      }
    }

    function showMessage(msg) {
      const messageEl = $('message');
      messageEl.style.opacity = '0';
      
      setTimeout(() => {
        messageEl.textContent = msg;
        messageEl.style.opacity = '1';
      }, 300);
    }

    function flashCircle() {
      const circle = $('magic-circle');
      circle.classList.add('glow');
      setTimeout(() => circle.classList.remove('glow'), 1500);
    }

    function updateStats() {
      $('level').textContent = gameState.level;
      $('xp').textContent = gameState.xp;
      $('next-level').textContent = gameState.nextLevelXp;
      $('combo').textContent = gameState.combo;
    }

    function addXP(amount = 1) {
      gameState.xp += amount;
      gameState.combo++;
      
      if (gameState.combo > gameState.maxCombo) {
        gameState.maxCombo = gameState.combo;
      }
      
      updateStats();
      
      // æ£€æŸ¥æ˜¯å¦å‡çº§
      if (gameState.xp >= gameState.nextLevelXp) {
        levelUp();
      }
    }

    function resetCombo() {
      gameState.combo = 0;
      updateStats();
    }

    function levelUp() {
      gameState.level++;
      gameState.xp = 0;
      gameState.nextLevelXp = gameState.level * gameState.levelStep;
      
      // æ˜¾ç¤ºå‡çº§æ•ˆæœ
      $('new-level').textContent = gameState.level;
      $('level-up-message').textContent = LEVEL_MESSAGES[Math.min(gameState.level - 1, LEVEL_MESSAGES.length - 1)];
      $('level-up').classList.add('show');
      
      try {
        playMagicSound();
      } catch (e) {
        console.log('å‡çº§éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
      }
      
      updateStats();
      
      // æ ¹æ®ç­‰çº§åˆ‡æ¢æ¸¸æˆé˜¶æ®µ
      if (gameState.level === 2) {
        // ä»å­—æ¯è®¤çŸ¥å‡çº§åˆ°æ‹¼è¯»å…¥é—¨
        $('level-up-continue').onclick = () => {
          $('level-up').classList.remove('show');
          switchScreen('phonics');
        };
      } else if (gameState.level === 4) {
        // ä»æ‹¼è¯»å…¥é—¨å‡çº§åˆ°å£°éŸ³é­”æ³•å¯¹å†³
        $('level-up-continue').onclick = () => {
          $('level-up').classList.remove('show');
          switchScreen('duel');
        };
      } else {
        // å…¶ä»–ç­‰çº§ç»§ç»­å½“å‰é˜¶æ®µ
        $('level-up-continue').onclick = () => {
          $('level-up').classList.remove('show');
        };
      }
    }

    function switchScreen(screenName) {
      // éšè—æ‰€æœ‰å±å¹•
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      // æ˜¾ç¤ºç›®æ ‡å±å¹•
      $(`${screenName}-screen`).classList.add('active');
      gameState.currentScreen = screenName;
      
      // åˆå§‹åŒ–å¯¹åº”é˜¶æ®µ
      switch (screenName) {
        case 'letter':
          initLetterPhase();
          break;
        case 'phonics':
          initPhonicsPhase();
          break;
        case 'duel':
          initDuelPhase();
          break;
      }
    }

    // æ˜¾ç¤ºå›¾ç‰‡æˆ–å›¾æ ‡
    function showImage(container, imageData) {
      if (!container) return;
      
      container.innerHTML = '';
      container.classList.remove('hidden');
      
      if (imageData.cssClass && imageData.cssClass !== '') {
        // ä½¿ç”¨CSSåˆ›å»ºçš„å›¾å½¢
        const cssImage = document.createElement('div');
        cssImage.className = imageData.cssClass;
        
        if (imageData.cssClass === 'css-cat') {
          // ä¸ºçŒ«æ·»åŠ è€³æœµ
          const leftEar = document.createElement('div');
          leftEar.className = 'css-cat-ear';
          const rightEar = document.createElement('div');
          rightEar.className = 'css-cat-ear';
          cssImage.appendChild(leftEar);
          cssImage.appendChild(rightEar);
        } else if (imageData.cssClass === 'css-dog') {
          // ä¸ºç‹—æ·»åŠ è€³æœµ
          const leftEar = document.createElement('div');
          leftEar.className = 'css-dog-ear';
          const rightEar = document.createElement('div');
          rightEar.className = 'css-dog-ear';
          cssImage.appendChild(leftEar);
          cssImage.appendChild(rightEar);
        }
        
        container.appendChild(cssImage);
      } else if (imageData.icon) {
        // ä½¿ç”¨Emojiå›¾æ ‡
        const iconEl = document.createElement('div');
        iconEl.className = 'image-icon';
        iconEl.textContent = imageData.icon;
        container.appendChild(iconEl);
      } else {
        // é»˜è®¤æ˜¾ç¤ºæ–‡å­—æè¿°
        container.textContent = imageData.description || '?';
      }
    }

    // è®©å›¾åƒåŠ¨èµ·æ¥
    function animateImage(container) {
      if (!container) return;
      
      const iconEl = container.querySelector('.image-icon');
      if (iconEl) {
        iconEl.classList.add('animate');
        setTimeout(() => iconEl.classList.remove('animate'), 500);
      } else {
        // å¯¹CSSå›¾åƒæ·»åŠ æŠ–åŠ¨æ•ˆæœ
        container.classList.add('shake');
        setTimeout(() => container.classList.remove('shake'), 500);
      }
    }

    /* æ¸¸æˆé˜¶æ®µåˆå§‹åŒ– */
    function initLetterPhase() {
      // æ¸…ç©ºå­—æ¯åŒºåŸŸ
      const bank = $('letter-bank');
      bank.innerHTML = '';
      
      // éšè—ç¤ºä¾‹è¯åŒºåŸŸ
      const exampleWords = $('example-words');
      exampleWords.innerHTML = '';
      exampleWords.classList.add('hidden');
      
      // éšè—å›¾åƒæ˜¾ç¤ºåŒº
      const imageDisplay = $('image-display');
      imageDisplay.innerHTML = '';
      imageDisplay.classList.add('hidden');
      
      // éšæœºé€‰æ‹©å­—æ¯
      const selectedLettersData = [];
      while (selectedLettersData.length < 6) {
        const letterData = rand(LETTERS_DATA);
        if (!selectedLettersData.some(data => data.letter === letterData.letter)) {
          selectedLettersData.push(letterData);
        }
      }
      
      // åˆ›å»ºå­—æ¯å¡ç‰‡
      selectedLettersData.forEach(letterData => {
        const card = document.createElement('div');
        card.className = 'card fade-in';
        card.textContent = letterData.letter;
        
        card.addEventListener('click', () => {
          // ä¿å­˜å½“å‰é€‰ä¸­çš„å­—æ¯æ•°æ®
          gameState.currentLetterData = letterData;
          
          // æ’­æ”¾å­—æ¯éŸ³
          try {
            speak(letterData.letter);
          } catch (e) {
            console.log('å­—æ¯å‘éŸ³å¤±è´¥:', e);
          }
          
          // é­”æ³•æ•ˆæœ
          $('magic-circle-content').textContent = letterData.letter;
          flashCircle();
          
          // æ˜¾ç¤ºç¤ºä¾‹è¯
          exampleWords.innerHTML = '';
          exampleWords.classList.remove('hidden');
          
          letterData.words.forEach(word => {
            const wordEl = document.createElement('div');
            wordEl.className = 'example-word fade-in';
            wordEl.textContent = word;
            wordEl.addEventListener('click', () => {
              // æ’­æ”¾å•è¯å‘éŸ³
              speak(word);
              
              // æ˜¾ç¤ºå›¾æ ‡
              showImage(imageDisplay, { icon: letterData.icon });
              animateImage(imageDisplay);
              
              // æç¤ºä¿¡æ¯
              showMessage(`${letterData.letter}å­—æ¯åœ¨å•è¯ "${word}" ä¸­!`);
            });
            
            exampleWords.appendChild(wordEl);
          });
          
          // éšæœºè¶£å‘³æç¤º
          showMessage(`ç‚¹å‡»å­—æ¯ ${letterData.letter} çš„ç¤ºä¾‹å•è¯ï¼Œå¬å¬å‘éŸ³å§!`);
          
          // å¢åŠ ç»éªŒ
          addXP();
          
          // éŸ³æ•ˆ
          try {
            playCorrectSound();
          } catch (e) {
            console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
          }
        });
        
        bank.appendChild(card);
      });
      
      showMessage('ç‚¹å‡»å­—æ¯ï¼Œé‡Šæ”¾é­”æ³•åŠ›é‡ï¼æŸ¥çœ‹æ¯ä¸ªå­—æ¯çš„ç¤ºä¾‹å•è¯ã€‚');
    }

    function initPhonicsPhase() {
      try {
        // é€‰æ‹©ä¸€ä¸ªæ‹¼è¯»ç»„åˆ
        gameState.currentPhonics = rand(PHONICS);
        
        // é€‰æ‹©ä¸€ä¸ªç›®æ ‡å•è¯
        const allPrefixes = gameState.currentPhonics.prefixes;
        const targetPrefix = rand(allPrefixes);
        const targetWord = targetPrefix + gameState.currentPhonics.suffix;
        
        // è®¾ç½®ç›®æ ‡å›¾åƒ
        gameState.targetImage = gameState.currentPhonics.words[targetWord];
        
        // æ˜¾ç¤ºç›®æ ‡å›¾åƒ
        const imageDisplay = $('image-display');
        showImage(imageDisplay, gameState.targetImage);
        
        // æ˜¾ç¤ºç›®æ ‡åŒºåŸŸ
        const target = $('phonics-target');
        target.classList.remove('hidden');
        target.innerHTML = `<span>_</span><span>${gameState.currentPhonics.suffix}</span>`;
        
        // æ¸…ç©ºå­—æ¯åŒºåŸŸ
        const bank = $('letter-bank');
        bank.innerHTML = '';
        
        // éšæœºé€‰æ‹©å‰ç¼€å­—æ¯ï¼ˆç¡®ä¿åŒ…å«æ­£ç¡®é€‰é¡¹ï¼‰
        const selectedPrefixes = [targetPrefix];
        
        while (selectedPrefixes.length < 4) {
          const prefix = rand(allPrefixes);
          if (!selectedPrefixes.includes(prefix)) {
            selectedPrefixes.push(prefix);
          }
        }
        
        // éšæœºæ’åº
        selectedPrefixes.sort(() => Math.random() - 0.5);
        
        // åˆ›å»ºå­—æ¯å¡ç‰‡
        selectedPrefixes.forEach(prefix => {
          const card = document.createElement('div');
          card.className = 'card fade-in';
          card.textContent = prefix;
          card.draggable = true;
          
          // æ‹–æ‹½äº‹ä»¶
          card.addEventListener('dragstart', () => {
            card.classList.add('dragging');
          });
          
          card.addEventListener('dragend', () => {
            card.classList.remove('dragging');
          });
          
          bank.appendChild(card);
        });
        
        // è®¾ç½®æ”¾ç½®åŒºåŸŸ
        target.ondragover = (e) => {
          e.preventDefault();
          target.classList.add('highlight');
        };
        
        target.ondragleave = () => {
          target.classList.remove('highlight');
        };
        
        target.ondrop = (e) => {
          e.preventDefault();
          target.classList.remove('highlight');
          
          const dragged = document.querySelector('.dragging');
          if (!dragged) return;
          
          const prefix = dragged.textContent;
          const word = prefix + gameState.currentPhonics.suffix;
          
          // æ›´æ–°ç›®æ ‡åŒºåŸŸæ˜¾ç¤º
          target.innerHTML = `<span>${prefix}</span><span>${gameState.currentPhonics.suffix}</span>`;
          
          // æ’­æ”¾å•è¯å‘éŸ³
          try {
            speak(word);
          } catch (e) {
            console.log('å•è¯å‘éŸ³å¤±è´¥:', e);
          }
          
          // é­”æ³•æ•ˆæœ
          $('magic-circle-content').textContent = word;
          
          // æ˜¾ç¤ºå¯¹åº”å›¾åƒ
          const wordImageData = gameState.currentPhonics.words[word] || { icon: 'â“', description: 'æœªçŸ¥ç‰©ä½“' };
          showImage(imageDisplay, wordImageData);
          animateImage(imageDisplay);
          
          // æ£€æŸ¥æ˜¯å¦æ˜¯ç›®æ ‡å•è¯
          if (word === targetWord) {
            try {
              playCorrectSound();
            } catch (e) {
              console.log('æ­£ç¡®éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
            }
            showMessage(`å¤ªæ£’äº†ï¼ä½ å¬å”¤å‡ºäº† "${word}"ï¼${gameState.targetImage.description || ''}`);
            addXP();
            flashCircle();
          } else {
            try {
              playWrongSound();
            } catch (e) {
              console.log('é”™è¯¯éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
            }
            showMessage(`ä½ æ‹¼å‡ºäº† "${word}"ï¼Œè¿™æ˜¯${wordImageData.description || 'åˆ«çš„ä¸œè¥¿'}ï¼Œä½†ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚å†è¯•ä¸€æ¬¡ï¼`);
            resetCombo();
            
            // æŠ–åŠ¨æ•ˆæœ
            target.classList.add('shake');
            setTimeout(() => target.classList.remove('shake'), 500);
          }
          
          // å»¶è¿Ÿåé‡ç½®
          setTimeout(() => {
            if (word === targetWord) {
              initPhonicsPhase(); // åªæœ‰æ­£ç¡®æ‰é‡æ–°ç”Ÿæˆæ–°é¢˜ç›®
            } else {
              // å¦‚æœé”™è¯¯ï¼Œæ¢å¤åˆ°åŸçŠ¶æ€è®©ç©å®¶ç»§ç»­å°è¯•
              target.innerHTML = `<span>_</span><span>${gameState.currentPhonics.suffix}</span>`;
              showImage(imageDisplay, gameState.targetImage);
            }
          }, 2000);
        };
        
        // æç¤ºä¿¡æ¯
        showMessage(`è¯·æ‹–åŠ¨æ­£ç¡®çš„å­—æ¯ï¼Œæ‹¼å‡º${gameState.targetImage.description || 'ç›®æ ‡å•è¯'}ï¼`);
      } catch (e) {
        console.log('æ‹¼è¯»é˜¶æ®µåˆå§‹åŒ–å¤±è´¥:', e);
        // å¦‚æœå‡ºé”™ï¼Œé‡æ–°å°è¯•
        setTimeout(initPhonicsPhase, 100);
      }
    }

    function initDuelPhase() {
      try {
        // æ ¹æ®ç©å®¶ç­‰çº§é€‰æ‹©å•è¯åˆ—è¡¨
        const wordListIndex = Math.min(Math.floor((gameState.level - 4) / 2), WORD_LISTS.length - 1);
        
        // éšæœºé€‰æ‹©3-4ä¸ªå•è¯
        const numWords = Math.min(4, WORD_LISTS[wordListIndex].length);
        gameState.currentDuelWords = [];
        
        while (gameState.currentDuelWords.length < numWords) {
          const word = rand(WORD_LISTS[wordListIndex]);
          if (!gameState.currentDuelWords.includes(word)) {
            gameState.currentDuelWords.push(word);
          }
        }
        
        // éšæœºé€‰æ‹©ä¸€ä¸ªä½œä¸ºç›®æ ‡å•è¯
        gameState.targetWord = rand(gameState.currentDuelWords);
        gameState.soundPlayed = false;
        
        // æ¸…ç©ºå•è¯é€‰é¡¹åŒºåŸŸ
        const wordOptions = $('word-options');
        wordOptions.innerHTML = '';
        
        // åˆ›å»ºå•è¯å¡ç‰‡
        gameState.currentDuelWords.forEach(word => {
          const card = document.createElement('div');
          card.className = 'word-card fade-in';
          card.textContent = word;
          
          card.addEventListener('click', () => {
            // æ£€æŸ¥æ˜¯å¦å·²æ’­æ”¾å‘éŸ³
            if (!gameState.soundPlayed) {
              showMessage('è¯·å…ˆç‚¹å‡»"æ’­æ”¾å‘éŸ³"æŒ‰é’®ï¼');
              return;
            }
            
            // æ£€æŸ¥æ˜¯å¦é€‰æ‹©æ­£ç¡®
            if (word === gameState.targetWord) {
              try {
                playCorrectSound();
              } catch (e) {
                console.log('æ­£ç¡®éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
              }
              
              // é­”æ³•æ•ˆæœ
              $('magic-circle-content').textContent = word;
              flashCircle();
              
              showMessage(`å¤ªæ£’äº†ï¼"${word}"æ˜¯æ­£ç¡®çš„ï¼${rand(RANDOM_EVENTS)}`);
              addXP(2); // å£°éŸ³å¯¹å†³ç»™äºˆåŒå€ç»éªŒ
            } else {
              try {
                playWrongSound();
              } catch (e) {
                console.log('é”™è¯¯éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
              }
              
              showMessage(`ä¸å¯¹ï¼Œæ­£ç¡®çš„å•è¯æ˜¯"${gameState.targetWord}"ï¼Œè¯·å†å¬ä¸€æ¬¡ã€‚`);
              resetCombo();
              
              // æŠ–åŠ¨æ•ˆæœ
              card.classList.add('shake');
              setTimeout(() => card.classList.remove('shake'), 500);
            }
            
            // å»¶è¿Ÿåé‡ç½®
            setTimeout(() => {
              $('magic-circle-content').textContent = '';
              initDuelPhase();
            }, 2000);
          });
          
          wordOptions.appendChild(card);
        });
        
        // è®¾ç½®æ’­æ”¾æŒ‰é’®
        $('play-sound-btn').onclick = () => {
          try {
            speak(gameState.targetWord);
            gameState.soundPlayed = true;
            showMessage('ä½ å¬åˆ°äº†ä»€ä¹ˆå•è¯ï¼Ÿå¿«é€Ÿé€‰æ‹©æ­£ç¡®çš„é€‰é¡¹ï¼');
          } catch (e) {
            console.log('å•è¯å‘éŸ³å¤±è´¥:', e);
            gameState.soundPlayed = true; // å³ä½¿å¤±è´¥ä¹Ÿå…è®¸ç©å®¶é€‰æ‹©
            showMessage('å‘éŸ³åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨ï¼Œè¯·é€‰æ‹©ä½ è®¤ä¸ºæ­£ç¡®çš„å•è¯ï¼');
          }
        };
        
        showMessage('ç‚¹å‡»"æ’­æ”¾å‘éŸ³"æŒ‰é’®ï¼Œç„¶åé€‰æ‹©ä½ å¬åˆ°çš„å•è¯ï¼');
      } catch (e) {
        console.log('å£°éŸ³å¯¹å†³é˜¶æ®µåˆå§‹åŒ–å¤±è´¥:', e);
        // å¦‚æœå‡ºé”™ï¼Œé‡æ–°å°è¯•
        setTimeout(initDuelPhase, 100);
      }
    }

    /* åˆå§‹åŒ–æ¸¸æˆ */
    function initGame() {
      try {
        // é‡ç½®æ¸¸æˆçŠ¶æ€
        gameState = {
          level: 1,
          xp: 0,
          nextLevelXp: 5,
          levelStep: 5,
          combo: 0,
          maxCombo: 0,
          currentScreen: 'start',
          mastered_letters: [],
          mastered_phonics: [],
          currentPhonics: null,
          currentDuelWords: [],
          targetWord: '',
          soundPlayed: false,
          targetImage: null,
          currentLetterData: null
        };
        
        updateStats();
        
        // è®¾ç½®å¼€å§‹æŒ‰é’®
        $('start-btn').onclick = () => {
          switchScreen('letter');
        };
        
        // è®¾ç½®å‡çº§ç»§ç»­æŒ‰é’®
        $('level-up-continue').onclick = () => {
          $('level-up').classList.remove('show');
        };
      } catch (e) {
        console.log('æ¸¸æˆåˆå§‹åŒ–å¤±è´¥:', e);
        // å¦‚æœå‡ºé”™ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º
        alert('æ¸¸æˆåŠ è½½å‡ºç°é—®é¢˜ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚');
      }
    }

    // å½“æ–‡æ¡£åŠ è½½å®Œæˆæ—¶åˆå§‹åŒ–æ¸¸æˆ
    document.addEventListener('DOMContentLoaded', initGame);
  </script>
</body>
</html>
