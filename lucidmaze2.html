<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquid Maze Game</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/js/libs/ammo.wasm.js"></script>
</head>
<body>
<script>
    let scene, camera, renderer;
    let liquid, goal, traps = [];
    let tilt = { x: 0, y: 0 };

    function init() {
        // Scene setup
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 20, 20);
        camera.lookAt(0, 0, 0);

        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Ambient light
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(10, 10, 10);
        scene.add(light);

        // Floor
        const floorGeometry = new THREE.BoxGeometry(20, 1, 20);
        const floorMaterial = new THREE.MeshStandardMaterial({ color: 0x808080 });
        const floor = new THREE.Mesh(floorGeometry, floorMaterial);
        floor.position.y = -0.5;
        scene.add(floor);

        // Liquid (Player)
        const liquidGeometry = new THREE.SphereGeometry(1, 32, 32);
        const liquidMaterial = new THREE.MeshStandardMaterial({ color: 0x00ffcc });
        liquid = new THREE.Mesh(liquidGeometry, liquidMaterial);
        liquid.position.set(0, 1, 0);
        scene.add(liquid);

        // Goal (Yellow Block)
        const goalGeometry = new THREE.BoxGeometry(2, 2, 2);
        const goalMaterial = new THREE.MeshStandardMaterial({ color: 0xffff00 });
        goal = new THREE.Mesh(goalGeometry, goalMaterial);
        goal.position.set(8, 1, 8);
        scene.add(goal);

        // Add initial traps (Red Blocks)
        for (let i = 0; i < 3; i++) {
            addTrap();
        }

        // Event listeners for tilt
        window.addEventListener('deviceorientation', handleOrientation);
        window.addEventListener('keydown', handleKey);

        animate();
    }

    function addTrap() {
        const trapGeometry = new THREE.BoxGeometry(2, 2, 2);
        const trapMaterial = new THREE.MeshStandardMaterial({ color: 0xff0000 });
        const trap = new THREE.Mesh(trapGeometry, trapMaterial);
        trap.position.set((Math.random() - 0.5) * 18, 1, (Math.random() - 0.5) * 18);
        traps.push(trap);
        scene.add(trap);
    }

    function handleOrientation(event) {
        tilt.x = event.beta / 90;  // Tilt range -90 to 90
        tilt.y = event.gamma / 90; // Tilt range -45 to 45
    }

    function handleKey(event) {
        if (event.key === 'ArrowUp') tilt.x = Math.max(tilt.x - 0.1, -1);
        if (event.key === 'ArrowDown') tilt.x = Math.min(tilt.x + 0.1, 1);
        if (event.key === 'ArrowLeft') tilt.y = Math.max(tilt.y - 0.1, -1);
        if (event.key === 'ArrowRight') tilt.y = Math.min(tilt.y + 0.1, 1);
    }

    function animate() {
        requestAnimationFrame(animate);

        // Apply tilt to the liquid
        liquid.position.x += tilt.y * 0.1;
        liquid.position.z += tilt.x * 0.1;

        // Collision detection with goal
        if (liquid.position.distanceTo(goal.position) < 2) {
            alert("You reached the goal!");
            liquid.position.set(0, 1, 0);
        }

        // Collision detection with traps
        traps.forEach(trap => {
            if (liquid.position.distanceTo(trap.position) < 2) {
                alert("You hit a trap!");
                liquid.position.set(0, 1, 0);
            }
        });

        renderer.render(scene, camera);
    }

    init();
</script>
</body>
</html>
